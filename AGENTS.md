# エージェント向けガイドライン

* 出力は日本語のみ。内部思考は英語で行う。
* 不明点や曖昧さは必ず質問で解消してから対応する。
* 依頼外の変更は事前に許可を得る。
* 複雑な処理や新規の関数・クラスには役割を説明するコメントを付ける。
* すべてのファイルで最終行に改行(\n)を入れ、不要な差分を防ぐ。

## AI駆動開発の基本姿勢

* わかりやすさと品質・保守性・安全性を常に両立させる。
* プロジェクトのフェーズに応じて簡潔さと堅牢性のバランスを取る。
* 見つけた問題は放置せず、修正または記録してボーイスカウトルールを守る。
* 技術的負債や妥協点は理由とともに明示する。

## 実装・エラーハンドリング

* DRYを徹底し、意味のある命名と一貫したスタイルを保つ。不要コードは削除。
* 外部入力や外部APIは失敗・悪用を前提に検証し、最小権限で扱う。秘密情報は環境変数で管理。
* エラーは握りつぶさず根本原因を修正し、早期検出・明確なメッセージを提供。エラーケースもテストする。
* 可観測性を確保し、タイムアウト・リトライ（指数バックオフ）・サーキットブレーカで信頼性を高める。

## 性能と設計

* 推測ではなく計測に基づき最適化し、拡張性を考慮する。N+1やオーバーフェッチを避ける。
* リソースは必要時に読み込み、キャッシュ方針（期限と無効化）を明確にする。

## テストとデバッグ

* テストはスキップせず、振る舞いを確認するものにする。高速・順不同で安定実行できるようにする。
* エラーケースも含め質の高いテストを重視し、問題があれば修正する。
* 再現手順の確立、最近の変更からの調査、適切なツール利用などデバッグのベストプラクティスを徹底する。

## Jujutsu(jj)とレビュー運用

* 変更管理は **Jujutsu(jj)** を前提とする。作業単位は「コミット」ではなく **変更（changeset）** として扱う。
* 変更の説明（description）は **コンベンショナル形式**（feat:, fix:, docs:, test:, refactor:, chore:）で、**日本語で明確**に書く。1変更1目的を原則にする。

  * 例: `feat: 設定画面に検索欄を追加`
* 作業は基本的に **スタック（積み重ね）** で進める。大きい変更は `jj split` で割り、関連する細片は `jj squash` でまとめ、履歴の読みやすさを維持する。
* 既存の変更の修正は「新しい変更を増やす」より **編集（amend相当）** を優先する。`jj describe` で説明を更新し、`jj rebase` でスタックを整える。
* trunk（例: main/master 相当）に対する作業は **直接の積み増しを避け**、ブックマーク（bookmark）やスタックの先端で進める。

  * ブックマークは「ブランチ相当」だが、jjの世界では **目印**。必要に応じて `jj bookmark create/set/move` を使う。
* レビュー提出前に以下を徹底する。

  * 差分を最小化（不要な整形や無関係な変更を混ぜない）
  * `jj diff` / `jj status` で意図通りの差分か確認
  * 説明（description）に「何を」「なぜ」「影響範囲」を書く
* リモートがGitの場合でも、ローカル運用はjjで統一する（必要に応じて `jj git push` などで同期する）。
* ロックファイルは必ず変更に含めて管理し、依存関係は必要最小限かつ定期更新する。
* レビューは建設的に行い、理由と影響を説明してフィードバックを歓迎する。

## ドキュメントと知識共有

* README等を最新化し、実例を優先して記載する。重要な設計判断はADRで残す。
* 調査結果や改善点を記録し、継続的な学習とプロセス改善に活かす。

これらを守り、常に「わかりやすい最高の回答」を提供してください。
